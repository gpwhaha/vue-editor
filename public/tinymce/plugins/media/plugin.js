(function(){var ma=tinymce.util.Tools.resolve("tinymce.PluginManager"),m=function(){m=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};return m.apply(this,arguments)},na=function(){},w=function(a){return function(){return a}},A=w(!1),I=w(!0),B=function(){return J},J=function(){var a=function(d){return d.isNone()},b=function(d){return d()},c=function(d){return d};a={fold:function(d,e){return d()},
is:A,isSome:A,isNone:I,getOr:c,getOrThunk:b,getOrDie:function(d){throw Error(d||"error: getOrDie called on none.");},getOrNull:w(null),getOrUndefined:w(void 0),or:c,orThunk:b,map:B,each:na,bind:B,exists:A,forall:I,filter:B,equals:a,equals_:a,toArray:function(){return[]},toString:w("none()")};Object.freeze&&Object.freeze(a);return a}(),K=function(a){var b=w(a),c=function(){return e},d=function(f){return f(a)},e={fold:function(f,h){return h(a)},is:function(f){return a===f},isSome:I,isNone:A,getOr:b,
getOrThunk:b,getOrDie:b,getOrNull:b,getOrUndefined:b,or:c,orThunk:c,map:function(f){return K(f(a))},each:function(f){f(a)},bind:d,exists:d,forall:d,filter:function(f){return f(a)?e:J},toArray:function(){return[a]},toString:function(){return"some("+a+")"},equals:function(f){return f.is(a)},equals_:function(f,h){return f.fold(A,function(g){return h(a,g)})}};return e},x={some:K,none:B,from:function(a){return null===a||void 0===a?J:K(a)}},r=function(a){return function(b){if(null===b)b="null";else{var c=
typeof b;b="object"===c&&(Array.prototype.isPrototypeOf(b)||b.constructor&&"Array"===b.constructor.name)?"array":"object"===c&&(String.prototype.isPrototypeOf(b)||b.constructor&&"String"===b.constructor.name)?"string":c}return b===a}},oa=r("string"),R=r("object"),pa=r("array");r=r("function");var qa=Array.prototype.push,S=function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c)},ra=function(a){for(var b=[],c=0,d=a.length;c<d;++c){if(!pa(a[c]))throw Error("Arr.flatten item "+c+" was not an array, input: "+
a);qa.apply(b,a[c])}return b};r(Array.from);var T=function(a){var b=a;return{get:function(){return b},set:function(c){b=c},clone:function(){return T(b)}}},sa=Object.hasOwnProperty,p=function(a,b){return sa.call(a,b)?x.from(a[b]):x.none()},n={getScripts:function(a){return a.getParam("media_scripts")},getAudioTemplateCallback:function(a){return a.getParam("audio_template_callback")},getVideoTemplateCallback:function(a){return a.getParam("video_template_callback")},hasLiveEmbeds:function(a){return a.getParam("media_live_embeds",
!0)},shouldFilterHtml:function(a){return a.getParam("media_filter_html",!0)},getUrlResolver:function(a){return a.getParam("media_url_resolver")},hasAltSource:function(a){return a.getParam("media_alt_source",!0)},hasPoster:function(a){return a.getParam("media_poster",!0)},hasDimensions:function(a){return a.getParam("media_dimensions",!0)}},u=tinymce.util.Tools.resolve("tinymce.util.Tools"),C=tinymce.util.Tools.resolve("tinymce.html.SaxParser");r=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils");var U=
function(a){return function(b){return b?b.style[a].replace(/px$/,""):""}},V=function(a){return function(b,c){b&&(b=b.style,c=/^[0-9.]+$/.test(c)?c+"px":c,b[a]=c)}},D={getMaxWidth:U("maxWidth"),getMaxHeight:U("maxHeight"),setMaxWidth:V("maxWidth"),setMaxHeight:V("maxHeight")},L=function(a,b){if(a)for(var c=0;c<a.length;c++)if(-1!==b.indexOf(a[c].filter))return a[c]},E=r.DOM,ta=function(a,b){var c={};C({validate:!1,allow_conditional_comments:!0,start:function(d,e){c.source||"param"!==d||(c.source=e.map.movie);
if("iframe"===d||"object"===d||"embed"===d||"video"===d||"audio"===d)c.type||(c.type=d),c=u.extend(e.map,c);if("script"===d){var f=L(a,e.map.src);if(!f)return;c={type:"script",source:e.map.src,width:String(f.width),height:String(f.height)}}"source"===d&&(c.source?c.altsource||(c.altsource=e.map.src):c.source=e.map.src);"img"!==d||c.poster||(c.poster=e.map.src)}}).parse(b);c.source=c.source||c.src||c.data;c.altsource=c.altsource||"";c.poster=c.poster||"";return c},F=function(a,b){var c=E.createFragment(b);
""!==E.getAttrib(c.firstChild,"data-ephox-embed-iri")?(a=E.createFragment(b).firstChild,a={type:"ephox-embed-iri",source:E.getAttrib(a,"data-ephox-embed-iri"),altsource:"",poster:"",width:D.getMaxWidth(a),height:D.getMaxHeight(a)}):a=ta(a,b);return a},W={guess:function(a){return(a={mp3:"audio/mpeg",m4a:"audio/x-m4a",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"}[a.toLowerCase().split(".").pop()])?a:""}},M=tinymce.util.Tools.resolve("tinymce.html.Writer"),
X=tinymce.util.Tools.resolve("tinymce.html.Schema"),N=r.DOM,v=function(a,b){var c,d;for(c in b){var e=""+b[c];if(a.map[c])for(d=a.length;d--;){var f=a[d];f.name===c&&(e?(a.map[c]=e,f.value=e):(delete a.map[c],a.splice(d,1)))}else e&&(a.push({name:c,value:e}),a.map[c]=e)}},y=["source","altsource"],ua=function(a,b,c){var d=M(),e=0,f;C({validate:!1,allow_conditional_comments:!0,comment:function(h){d.comment(h)},cdata:function(h){d.cdata(h)},text:function(h,g){d.text(h,g)},start:function(h,g,k){switch(h){case "video":case "object":case "embed":case "img":case "iframe":void 0!==
b.height&&void 0!==b.width&&(console.log(b),v(g,{width:b.width,height:b.height}))}if(c)switch(h){case "video":v(g,{poster:b.poster,src:""});b.altsource&&v(g,{src:""});break;case "iframe":v(g,{src:b.source});break;case "source":if(2>e&&(v(g,{src:b[y[e]],type:b[y[e]+"mime"]}),!b[y[e]]))return;e++;break;case "img":if(!b.poster)return;f=!0}d.start(h,g,k)},end:function(h){if("video"===h&&c)for(var g=0;2>g;g++)if(b[y[g]]){var k=[];k.map={};e<g&&(v(k,{src:b[y[g]],type:b[y[g]+"mime"]}),d.start("source",k,
!0))}b.poster&&"object"===h&&c&&!f&&(g=[],g.map={},v(g,{src:b.poster,width:b.width,height:b.height}),d.start("img",g,!0));d.end(h)}},X({})).parse(a);return d.getContent()},O={updateHtml:function(a,b,c){var d=N.createFragment(a);""!==N.getAttrib(d.firstChild,"data-ephox-embed-iri")?(a=N.createFragment(a).firstChild,D.setMaxWidth(a,b.width),D.setMaxHeight(a,b.height),b=a.outerHTML,a=M(),C(a).parse(b),b=a.getContent()):b=ua(a,b,c);return b}},va=[{regex:/youtu\.be\/([\w\-_\?&=.]+)/i,type:"iframe",w:560,
h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)(&([a-z0-9&=\-_]+))?/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$2?$4",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\?&=\-_]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,
type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?title=0&amp;byline=0",allowFullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0},{regex:/dai\.ly\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0}],wa=function(a){return(a=
a.match(/^(https?:\/\/|www\.)(.+)$/i))&&1<a.length?"www."===a[1]?"https://":a[1]:"https://"},xa=function(a,b){var c=wa(b),d=a.regex.exec(b),e=c+a.url;a=function(f){e=e.replace("$"+f,function(){return d[f]?d[f]:""})};for(b=0;b<d.length;b++)a(b);return e.replace(/\?$/,"")},ya=function(a){var b=va.filter(function(c){return c.regex.test(a)});return 0<b.length?u.extend({},b[0],{url:xa(b[0],a)}):null},za=function(a){var b='<object data="'+a.source+'" width="'+a.width+'" height="'+a.height+'" type="application/x-shockwave-flash">';
a.poster&&(b+='<img src="'+a.poster+'" width="'+a.width+'" height="'+a.height+'" />');return b+"</object>"},Aa=function(a,b){return b?b(a):'<audio controls="controls" src="'+a.source+'">'+(a.altsource?'\n<source src="'+a.altsource+'"'+(a.altsourcemime?' type="'+a.altsourcemime+'"':"")+" />\n":"")+"</audio>"},Ba=function(a,b){return b?b(a):'<video width="'+a.width+'" height="'+a.height+'"'+(a.poster?' poster="'+a.poster+'"':"")+' controls="controls">\n<source src="'+a.source+'"'+(a.sourcemime?' type="'+
a.sourcemime+'"':"")+" />\n"+(a.altsource?'<source src="'+a.altsource+'"'+(a.altsourcemime?' type="'+a.altsourcemime+'"':"")+" />\n":"")+"</video>"},Y=function(a,b){var c=u.extend({},b);if(!c.source&&(u.extend(c,F(n.getScripts(a),c.embed)),!c.source))return"";c.altsource||(c.altsource="");c.poster||(c.poster="");c.source=a.convertURL(c.source,"source");c.altsource=a.convertURL(c.altsource,"source");c.sourcemime=W.guess(c.source);c.altsourcemime=W.guess(c.altsource);c.poster=a.convertURL(c.poster,
"poster");if(b=ya(c.source))c.source=b.url,c.type=b.type,c.allowFullscreen=b.allowFullscreen,c.width=c.width||String(b.w),c.height=c.height||String(b.h);if(c.embed)return O.updateHtml(c.embed,c,!0);if(b=L(n.getScripts(a),c.source))c.type="script",c.width=String(b.width),c.height=String(b.height);b=n.getAudioTemplateCallback(a);var d=n.getVideoTemplateCallback(a);c.width=c.width||"300";c.height=c.height||"150";u.each(c,function(e,f){c[f]=a.dom.encode(""+e)});return"iframe"===c.type?'<iframe src="'+
c.source+'" width="'+c.width+'" height="'+c.height+'"'+(c.allowFullscreen?' allowFullscreen="1"':"")+"></iframe>":"application/x-shockwave-flash"===c.sourcemime?za(c):-1!==c.sourcemime.indexOf("audio")?Aa(c,b):"script"===c.type?'<script src="'+c.source+'">\x3c/script>':Ba(c,d)},Z=tinymce.util.Tools.resolve("tinymce.util.Promise"),G={},Ca=function(a,b,c){return new Z(function(d,e){var f=function(h){h.html&&(G[a.source]=h);return d({url:a.source,html:h.html?h.html:b(a)})};G[a.source]?f(G[a.source]):
c({url:a.source},f,e)})},Da=function(a,b){return new Z(function(c){c({html:b(a),url:a.source})})},aa=function(a){return function(b){return Y(a,b)}},P={getEmbedHtml:function(a,b){var c=n.getUrlResolver(a);return c?Ca(b,aa(a),c):Da(b,aa(a))},isCached:function(a){return G.hasOwnProperty(a)}},Ea=function(a,b){return p(b,a).bind(function(c){return p(c,"meta")})},Fa=function(a,b,c){return function(d){var e,f=function(){return p(b,d)},h=function(l){return p(l,"value").bind(function(q){return 0<q.length?
x.some(q):x.none()})},g=function(){return p(a,d).bind(function(l){return R(l)?h(l).orThunk(f):f().orThunk(function(){return x.from(l)})})},k=function(){return f().orThunk(function(){return p(a,d).bind(function(l){return R(l)?h(l):x.from(l)})})};return e={},e[d]=(d===c?g():k()).getOr(""),e}},Ga=function(a,b){var c={};p(a,"dimensions").each(function(d){S(["width","height"],function(e){p(b,e).orThunk(function(){return p(d,e)}).each(function(f){return c[e]=f})})});return c},z=function(a,b){var c=b?Ea(b,
a).getOr({}):{};b=Fa(a,c,b);return m(m(m(m(m({},b("source")),b("altsource")),b("poster")),b("embed")),Ga(a,c))},H=function(a){var b=m(m({},a),{source:{value:p(a,"source").getOr("")},altsource:{value:p(a,"altsource").getOr("")},poster:{value:p(a,"poster").getOr("")}});S(["width","height"],function(c){p(a,c).each(function(d){var e=b.dimensions||{};e[c]=d;b.dimensions=e})});return b},ba=function(a){return function(b){a.notificationManager.open({type:"error",text:b&&b.msg?"Media embed handler error: "+
b.msg:"Media embed handler threw unknown error."})}},Ha=function(a){var b=a.selection.getNode();b=b.getAttribute("data-mce-object")||b.getAttribute("data-ephox-embed-iri")?a.serializer.serialize(b,{selection:!0}):"";return m({embed:b},F(n.getScripts(a),b))},ca=function(a,b){return function(c){if(oa(c.url)&&0<c.url.trim().length){var d=c.html;var e=F(n.getScripts(b),d);c=m(m({},e),{source:c.url,embed:d});a.setData(H(c))}}},da=function(a,b){var c=a.dom.select("img[data-mce-object]");a.insertContent(b);
b=a.dom.select("img[data-mce-object]");for(var d=0;d<c.length;d++)for(var e=b.length-1;0<=e;e--)c[d]===b[e]&&b.splice(e,1);a.selection.select(b[0]);a.nodeChanged()},Ia=function(a,b,c){b.embed=O.updateHtml(b.embed,b);b.embed&&(a.source===b.source||P.isCached(b.source))?da(c,b.embed):P.getEmbedHtml(c,b).then(function(d){da(c,d.html)}).catch(ba(c))},ea={showDialog:function(a){var b=Ha(a),c=T(b);b=H(b);var d=n.hasDimensions(a)?[{type:"sizeinput",name:"dimensions",label:"Constrain proportions",constrain:!0}]:
[],e={title:"General",name:"general",items:ra([[{name:"source",type:"urlinput",filetype:"media",label:"Source"}],d])};d=[];n.hasAltSource(a)&&d.push({name:"altsource",type:"urlinput",filetype:"media",label:"Alternative source URL"});n.hasPoster(a)&&d.push({name:"poster",type:"urlinput",filetype:"image",label:"Media poster (Image URL)"});var f={title:"Advanced",name:"advanced",items:d};e=[e,{title:"Embed",items:[{type:"textarea",name:"embed",label:"Paste your embed code below:"}]}];0<d.length&&e.push(f);
var h=a.windowManager.open({title:"Insert/Edit Media",size:"normal",body:{type:"tabpanel",tabs:e},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(g){var k=z(g.getData());Ia(c.get(),k,a);g.close()},onChange:function(g,k){switch(k.name){case "source":k=c.get();var l=z(g.getData(),"source");k.source!==l.source&&(ca(h,a)({url:l.source,html:""}),P.getEmbedHtml(a,l).then(ca(h,a)).catch(ba(a)));break;case "embed":k=z(g.getData()).embed;
k=F(n.getScripts(a),k);g.setData(H(k));break;case "dimensions":case "altsource":case "poster":k=k.name,k=z(g.getData(),k),l=Y(a,k),g.setData(H(m(m({},k),{embed:l})))}c.set(z(g.getData()))},initialData:b})},unwrap:z},Ja={get:function(a){return{showDialog:function(){ea.showDialog(a)}}}},Ka={register:function(a){a.addCommand("mceMedia",function(){ea.showDialog(a)})}},t=tinymce.util.Tools.resolve("tinymce.html.Node"),fa=tinymce.util.Tools.resolve("tinymce.Env"),ha={sanitize:function(a,b){if(!1===n.shouldFilterHtml(a))return b;
var c=M(),d;C({validate:!1,allow_conditional_comments:!1,comment:function(e){c.comment(e)},cdata:function(e){c.cdata(e)},text:function(e,f){c.text(e,f)},start:function(e,f,h){d=!0;if("script"!==e&&"noscript"!==e){for(var g=0;g<f.length;g++){if(0===f[g].name.indexOf("on"))return;"style"===f[g].name&&(f[g].value=a.dom.serializeStyle(a.dom.parseStyle(f[g].value),e))}c.start(e,f,h);d=!1}},end:function(e){d||c.end(e)}},X({})).parse(b);return c.getContent()}},ia=function(a,b){var c=b.name;var d=new t("img",
1);d.shortEnded=!0;Q(a,b,d);d.attr({width:b.attr("width")||"300",height:b.attr("height")||("audio"===c?"30":"150"),style:b.attr("style"),src:fa.transparentSrc,"data-mce-object":c,"class":"mce-object mce-object-"+c});return d},ja=function(a,b){var c=b.name;if("bdMap"==b.attributes.map.name){var d=new t("span",1);d.attr({src:b.attr("src"),contentEditable:"false",class:b.attr("class"),width:"auto",height:"auto"});Q(a,b,d);a=new t(c,1);a.attr({src:b.attr("src"),allowfullscreen:b.attr("allowfullscreen"),
style:b.attr("style"),class:b.attr("class"),width:b.attr("width"),height:b.attr("height"),frameborder:"0"});d.append(a)}else d=new t("span",1),d.attr({contentEditable:"false",style:b.attr("style"),"data-mce-object":c,"class":"mce-preview-object mce-object-"+c}),Q(a,b,d),a=new t(c,1),a.attr({src:b.attr("src"),allowfullscreen:b.attr("allowfullscreen"),style:b.attr("style"),class:b.attr("class"),width:b.attr("width"),height:b.attr("height"),frameborder:"0"}),b=new t("span",1),b.attr("class","mce-shim"),
d.append(a),d.append(b);return d},Q=function(a,b,c){var d;var e=b.attributes;for(d=e.length;d--;){var f=e[d].name;var h=e[d].value;if("width"!==f&&"height"!==f&&"style"!==f){if("data"===f||"src"===f)h=a.convertURL(h,f);c.attr("data-mce-p-"+f,h)}}if(b=b.firstChild&&b.firstChild.value)c.attr("data-mce-html",escape(ha.sanitize(a,b))),c.firstChild=null},ka=function(a){for(;a=a.parent;){var b;(b=a.attr("data-ephox-embed-iri"))||(b=(b=a.attr("class"))&&/\btiny-pageembed\b/.test(b));if(b)return!0}return!1},
La={createPreviewIframeNode:ja,createPlaceholderNode:ia,placeHolderConverter:function(a){return function(b){for(var c=b.length,d,e;c--;)if(d=b[c],d.parent&&!d.parent.attr("data-mce-object")){if("script"===d.name&&(e=L(n.getScripts(a),d.attr("src")),!e))continue;e&&(e.width&&d.attr("width",e.width.toString()),e.height&&d.attr("height",e.height.toString()));"iframe"===d.name&&n.hasLiveEmbeds(a)&&fa.ceFalse?ka(d)||d.replace(ja(a,d)):ka(d)||d.replace(ia(a,d))}}}},Ma={setup:function(a){a.on("preInit",
function(){var b=a.schema.getSpecialElements();u.each(["video","audio","iframe","object"],function(d){b[d]=new RegExp("</"+d+"[^>]*>","gi")});var c=a.schema.getBoolAttrs();u.each(["webkitallowfullscreen","mozallowfullscreen","allowfullscreen"],function(d){c[d]={}});a.parser.addNodeFilter("iframe,video,audio,object,embed,script",La.placeHolderConverter(a));a.serializer.addAttributeFilter("data-mce-object",function(d,e){for(var f=d.length,h,g,k,l,q;f--;)if(h=d[f],h.parent){q=h.attr(e);g=new t(q,1);
"audio"!==q&&"script"!==q&&((k=h.attr("class"))&&-1!==k.indexOf("mce-preview-object")?g.attr({width:h.firstChild.attr("width"),height:h.firstChild.attr("height")}):g.attr({width:h.attr("width"),height:h.attr("height")}));g.attr({style:h.attr("style")});l=h.attributes;for(k=l.length;k--;){var la=l[k].name;0===la.indexOf("data-mce-p-")&&g.attr(la.substr(11),l[k].value)}"script"===q&&g.attr("type","text/javascript");if(q=h.attr("data-mce-html"))k=new t("#text",3),k.raw=!0,k.value=ha.sanitize(a,unescape(q)),
g.append(k);h.replace(g)}})});a.on("SetContent",function(){a.$("span.mce-preview-object").each(function(b,c){b=a.$(c);0===b.find("span.mce-shim").length&&b.append('<span class="mce-shim"></span>')})})}},Na={setup:function(a){a.on("ResolveName",function(b){var c;1===b.target.nodeType&&(c=b.target.getAttribute("data-mce-object"))&&(b.name=c)})}},Oa={setup:function(a){a.on("click keyup touchend",function(){var b=a.selection.getNode();b&&a.dom.hasClass(b,"mce-preview-object")&&a.dom.getAttrib(b,"data-mce-selected")&&
b.setAttribute("data-mce-selected","2")});a.on("ObjectSelected",function(b){var c=b.target.getAttribute("data-mce-object");"audio"!==c&&"script"!==c||b.preventDefault()});a.on("ObjectResized",function(b){var c=b.target,d;c.getAttribute("data-mce-object")&&(d=c.getAttribute("data-mce-html"))&&(d=unescape(d),c.setAttribute("data-mce-html",escape(O.updateHtml(d,{width:String(b.width),height:String(b.height)}))))})}},Pa=function(a,b){return function(c){return a.selection.selectorChangedWithUnbind(b.join(","),
c.setActive).unbind}},Qa={register:function(a){a.ui.registry.addToggleButton("media",{tooltip:"Insert/edit media",icon:"embed",onAction:function(){a.execCommand("mceMedia")},onSetup:Pa(a,["img[data-mce-object]","span[data-mce-object]","div[data-ephox-embed-iri]"])});a.ui.registry.addMenuItem("media",{icon:"embed",text:"Media...",onAction:function(){a.execCommand("mceMedia")}})}};(function(){ma.add("media",function(a){Ka.register(a);Qa.register(a);Na.setup(a);Ma.setup(a);Oa.setup(a);return Ja.get(a)})})()})();