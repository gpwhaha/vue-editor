(function(D){function Aa(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;a=Array(a);var d=0;for(b=0;b<c;b++)for(var e=arguments[b],f=0,g=e.length;f<g;f++,d++)a[d]=e[f];return a}var V=function(a){var b=a;return{get:function(){return b},set:function(c){b=c},clone:function(){return V(b)}}},Ba=tinymce.util.Tools.resolve("tinymce.PluginManager"),y=function(){y=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,
  e)&&(a[e]=b[e])}return a};return y.apply(this,arguments)},W=function(){},q=function(a){return function(){return a}},Ca=function(a){return a},Da=function(a){return function(){throw Error(a);}},r=q(!1),z=q(!0),I=function(){return P},P=function(){var a=function(d){return d.isNone()},b=function(d){return d()},c=function(d){return d};a={fold:function(d,e){return d()},is:r,isSome:r,isNone:z,getOr:c,getOrThunk:b,getOrDie:function(d){throw Error(d||"error: getOrDie called on none.");},getOrNull:q(null),getOrUndefined:q(void 0),
  or:c,orThunk:b,map:I,each:W,bind:I,exists:r,forall:z,filter:I,equals:a,equals_:a,toArray:function(){return[]},toString:q("none()")};Object.freeze&&Object.freeze(a);return a}(),Q=function(a){var b=q(a),c=function(){return e},d=function(f){return f(a)},e={fold:function(f,g){return g(a)},is:function(f){return a===f},isSome:z,isNone:r,getOr:b,getOrThunk:b,getOrDie:b,getOrNull:b,getOrUndefined:b,or:c,orThunk:c,map:function(f){return Q(f(a))},each:function(f){f(a)},bind:d,exists:d,forall:d,filter:function(f){return f(a)?
  e:P},toArray:function(){return[a]},toString:function(){return"some("+a+")"},equals:function(f){return f.is(a)},equals_:function(f,g){return f.fold(r,function(h){return g(a,h)})}};return e},l={some:Q,none:I,from:function(a){return null===a||void 0===a?P:Q(a)}},t=function(a){return function(b){if(null===b)b="null";else{var c=typeof b;b="object"===c&&(Array.prototype.isPrototypeOf(b)||b.constructor&&"Array"===b.constructor.name)?"array":"object"===c&&(String.prototype.isPrototypeOf(b)||b.constructor&&
  "String"===b.constructor.name)?"string":c}return b===a}},A=t("string"),Ea=t("object"),E=t("array");t=t("function");var Fa=Array.prototype.slice,X=Array.prototype.indexOf,J=function(a,b){for(var c=a.length,d=Array(c),e=0;e<c;e++)d[e]=b(a[e],e);return d},x=function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c)},Ga=function(a,b){for(var c=a.length-1;0<=c;c--)b(a[c],c)},Y=function(a,b){for(var c=[],d=0,e=a.length;d<e;d++){var f=a[d];b(f,d)&&c.push(f)}return c},Z=function(a,b,c){Ga(a,function(d){c=b(c,
  d)});return c},Ha=function(a,b,c){x(a,function(d){c=b(c,d)});return c},Ia=function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];if(b(e,c))return l.some(e)}return l.none()},aa=function(a,b){for(var c=0,d=a.length;c<d;++c)if(!0!==b(a[c],c))return!1;return!0},Ja=function(a,b){a=Fa.call(a,0);a.sort(b);return a},Ka=function(a){return 0===a.length?l.none():l.some(a[0])};t(Array.from);var ba=Object.keys,ca=Object.hasOwnProperty,La=function(a,b){return ca.call(a,b)?l.from(a[b]):l.none()};(function(a){if(!E(a))throw Error("cases must be an array");
  if(0===a.length)throw Error("there must be at least one case");var b=[],c={};x(a,function(d,e){var f=ba(d);if(1!==f.length)throw Error("one and only one name per case");var g=f[0],h=d[g];if(void 0!==c[g])throw Error("duplicate key detected:"+g);if("cata"===g)throw Error("cannot have a case named cata (sorry)");if(!E(h))throw Error("case arguments must be an array");b.push(g);c[g]=function(){var k=arguments.length;if(k!==h.length)throw Error("Wrong number of arguments to case "+g+". Expected "+h.length+
  " ("+h+"), got "+k);var m=Array(k);for(k=0;k<m.length;k++)m[k]=arguments[k];return{fold:function(){if(arguments.length!==a.length)throw Error("Wrong number of arguments to fold. Expected "+a.length+", got "+arguments.length);return arguments[e].apply(null,m)},match:function(p){var n=ba(p);if(b.length!==n.length)throw Error("Wrong number of arguments to match. Expected: "+b.join(",")+"\nActual: "+n.join(","));if(!aa(b,function(u){return-1<X.call(n,u)}))throw Error("Not all branches were specified when using match. Specified: "+
  n.join(", ")+"\nRequired: "+b.join(", "));return p[g].apply(null,m)},log:function(p){D.console.log(p,{constructors:b,constructor:g,params:m})}}}});return c})([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);var da=function(a){var b=[],c=[];x(a,function(d){d.fold(function(e){b.push(e)},function(e){c.push(e)})});return{errors:b,values:c}},B=function(a){return{is:function(b){return a===b},isValue:z,isError:r,getOr:q(a),
  getOrThunk:q(a),getOrDie:q(a),or:function(b){return B(a)},orThunk:function(b){return B(a)},fold:function(b,c){return c(a)},map:function(b){return B(b(a))},mapError:function(b){return B(a)},each:function(b){b(a)},bind:function(b){return b(a)},exists:function(b){return b(a)},forall:function(b){return b(a)},toOption:function(){return l.some(a)}}},F=function(a){return{is:r,isValue:r,isError:z,getOr:Ca,getOrThunk:function(b){return b()},getOrDie:function(){return Da(String(a))()},or:function(b){return b},
  orThunk:function(b){return b()},fold:function(b,c){return b(a)},map:function(b){return F(a)},mapError:function(b){return F(b(a))},each:W,bind:function(b){return F(a)},exists:r,forall:z,toOption:l.none}},K={value:B,error:F,fromOption:function(a,b){return a.fold(function(){return F(b)},B)}},Ma=function(a){return"inline-command"===a.type||"inline-format"===a.type},Na=function(a){return"block-command"===a.type||"block-format"===a.type},Oa=function(a){return Ja(a,function(b,c){return b.start.length===
  c.start.length?0:b.start.length>c.start.length?-1:1})},ea=function(a){var b=function(f){return K.error({message:f,pattern:a})},c=function(f,g,h){if(void 0!==a.format){if(E(a.format)){if(!aa(a.format,A))return b(f+" pattern has non-string items in the `format` array");f=a.format}else if(A(a.format))f=[a.format];else return b(f+" pattern has non-string `format` parameter");return K.value(g(f))}return void 0!==a.cmd?A(a.cmd)?K.value(h(a.cmd,a.value)):b(f+" pattern has non-string `cmd` parameter"):b(f+
  " pattern is missing both `format` and `cmd` parameters")};if(!Ea(a))return b("Raw pattern is not an object");if(!A(a.start))return b("Raw pattern is missing `start` parameter");if(void 0!==a.end){if(!A(a.end))return b("Inline pattern has non-string `end` parameter");if(0===a.start.length&&0===a.end.length)return b("Inline pattern has empty `start` and `end` parameters");var d=a.start,e=a.end;0===e.length&&(e=d,d="");return c("Inline",function(f){return{type:"inline-format",start:d,end:e,format:f}},
  function(f,g){return{type:"inline-command",start:d,end:e,cmd:f,value:g}})}return void 0!==a.replacement?A(a.replacement)?0===a.start.length?b("Replacement pattern has empty `start` parameter"):K.value({type:"inline-command",start:"",end:a.start,cmd:"mceInsertContent",value:a.replacement}):b("Replacement pattern has non-string `replacement` parameter"):0===a.start.length?b("Block pattern has empty `start` parameter"):c("Block",function(f){return{type:"block-format",start:a.start,format:f[0]}},function(f,
  g){return{type:"block-command",start:a.start,cmd:f,value:g}})},fa=function(a){if("block-command"===a.type)return{start:a.start,cmd:a.cmd,value:a.value};if("block-format"===a.type)return{start:a.start,format:a.format};if("inline-command"===a.type)return"mceInsertContent"===a.cmd&&""===a.start?{start:a.end,replacement:a.value}:{start:a.start,end:a.end,cmd:a.cmd,value:a.value};if("inline-format"===a.type)return{start:a.start,end:a.end,format:1===a.format.length?a.format[0]:a.format}},ha=function(a){return{inlinePatterns:Y(a,
  Ma),blockPatterns:Oa(Y(a,Na))}},Pa={get:function(a){return{setPatterns:function(b){b=da(J(b,ea));if(0<b.errors.length)throw b=b.errors[0],Error(b.message+":\n"+JSON.stringify(b.pattern,null,2));a.set(ha(b.values))},getPatterns:function(){return Aa(J(a.get().inlinePatterns,fa),J(a.get().blockPatterns,fa))}}}},Qa="undefined"!==typeof D.window?D.window:Function("return this;")(),ia=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];(b=Qa.console)&&(b.error?b.error.apply(b,a):b.log.apply(b,
  a))},Ra=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],Sa=function(a){a=La(a,"textpattern_patterns").getOr(Ra);if(!E(a))return ia("The setting textpattern_patterns should be an array"),{inlinePatterns:[],
  blockPatterns:[]};a=da(J(a,ea));x(a.errors,function(b){return ia(b.message,b.pattern)});return ha(a.values)},ja=function(a){a=a.getParam("forced_root_block","p");return!1===a?"":!0===a?"p":a},Ta=tinymce.util.Tools.resolve("tinymce.util.Delay"),ka=tinymce.util.Tools.resolve("tinymce.util.VK"),Ua=tinymce.util.Tools.resolve("tinymce.util.Tools");t=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils");var G=tinymce.util.Tools.resolve("tinymce.dom.TextSeeker"),v=function(a,b){return{container:a,offset:b}},
  w=function(a){return a.nodeType===D.Node.TEXT_NODE},C=function(a,b,c){if(b&&a.isEmpty(b)&&!c(b)){var d=b.parentNode;a.remove(b);C(a,d,c)}},L=function(a,b,c,d){void 0===d&&(d=!0);var e=b.startContainer.parentNode,f=b.endContainer.parentNode;b.deleteContents();d&&!c(b.startContainer)&&(w(b.startContainer)&&0===b.startContainer.data.length&&a.remove(b.startContainer),w(b.endContainer)&&0===b.endContainer.data.length&&a.remove(b.endContainer),C(a,e,c),e!==f&&C(a,f,c))},Va=function(a,b){a=b.get(a);return E(a)&&
  Ka(a).exists(function(c){return ca.call(c,"block")})},R=function(a,b){b=l.from(a.dom.getParent(b.startContainer,a.dom.isBlock));return""===ja(a)?b.orThunk(function(){return l.some(a.getBody())}):b},M=t.DOM,N=function(a){return function(b){return a===b?-1:0}},Wa=function(a){return function(b){var c;(c=a.isBlock(b))||(c=-1<X.call(["BR","IMG","HR","INPUT"],b.nodeName));return c||"false"===a.getContentEditable(b)}},S=function(a,b,c){if(w(a)&&0<=b)return l.some(v(a,b));var d=G(M);return l.from(d.backwards(a,
  b,N(a),c)).map(function(e){return v(e.container,e.container.data.length)})},Xa=function(a,b,c){if(w(a)&&b>=a.length)return l.some(v(a,b));var d=G(M);return l.from(d.forwards(a,b,N(a),c)).map(function(e){return v(e.container,0)})},T=function(a,b,c){if(!w(a))return l.none();var d=a.textContent;if(0<=b&&b<=d.length)return l.some(v(a,b));d=G(M);return l.from(d.backwards(a,b,N(a),c)).bind(function(e){return T(e.container,b+e.container.data.length,c)})},la=function(a,b,c){if(!w(a))return l.none();var d=
  a.textContent;if(b<=d.length)return l.some(v(a,b));var e=G(M);return l.from(e.forwards(a,b,N(a),c)).bind(function(f){return la(f.container,b-d.length,c)})},Ya=function(a,b,c,d,e){a=G(a,Wa(a));return l.from(a.backwards(b,c,d,e))},ma=function(a,b,c){if(w(b)&&(0>c||c>b.data.length))return[];for(c=[c];b!==a&&b.parentNode;){for(var d=b.parentNode,e=0;e<d.childNodes.length;e++)if(d.childNodes[e]===b){c.push(e);break}b=d}return b===a?c.reverse():[]},U=function(a,b,c,d,e){b=ma(a,b,c);a=ma(a,d,e);return{start:b,
  end:a}},na=function(a,b){b=b.slice();var c=b.pop();return Ha(b,function(d,e){return d.bind(function(f){return l.from(f.childNodes[e])})},l.some(a)).bind(function(d){w(d);return l.some({node:d,offset:c})})},oa=function(a,b){return na(a,b.start).bind(function(c){var d=c.node,e=c.offset;return na(a,b.end).map(function(f){var g=f.node;f=f.offset;var h=D.document.createRange();h.setStart(d,e);h.setEnd(g,f);return h})})},pa=function(a,b,c){Xa(b,0,b).each(function(d){var e=d.container;la(e,c.start.length,
  b).each(function(f){var g=a.createRng();g.setStart(e,0);g.setEnd(f.container,f.offset);L(a,g,function(h){return h===b})})})},Za=function(a,b){var c=b.pattern;b=oa(a.dom.getRoot(),b.range).getOrDie("Unable to resolve path range");R(a,b).each(function(d){"block-format"===c.type?Va(c.format,a.formatter)&&a.undoManager.transact(function(){pa(a.dom,d,c);a.formatter.apply(c.format)}):"block-command"===c.type&&a.undoManager.transact(function(){pa(a.dom,d,c);a.execCommand(c.cmd,!1,c.value)})});return!0},
  $a=function(a,b){var c=b.replace("\u00a0"," ");return Ia(a,function(d){return 0!==b.indexOf(d.start)&&0!==c.indexOf(d.start)?!1:!0})},ab=function(a,b){var c=a.dom,d=a.selection.getRng();return R(a,d).filter(function(e){var f=ja(a);f=""===f&&c.is(e,"body")||c.is(e,f);return null!==e&&f}).bind(function(e){var f=e.textContent;return $a(b,f).map(function(g){return Ua.trim(f).length===g.start.length?[]:[{pattern:g,range:U(c.getRoot(),e,0,e,0)}]})}).getOr([])},bb=function(a,b){if(0!==b.length){var c=a.selection.getBookmark();
  x(b,function(d){return Za(a,d)});a.selection.moveToBookmark(c)}},qa=0,cb=function(a){var b=(new Date).getTime(),c=Math.floor(1E9*Math.random());qa++;return a+"_"+c+qa+String(b)},ra=function(a,b){return a.create("span",{"data-mce-type":"bookmark",id:b})},O=function(a,b){a=a.createRng();a.setStartAfter(b.start);a.setEndBefore(b.end);return a},sa=function(a,b,c){c=oa(a.getRoot(),c).getOrDie("Unable to resolve path range");var d=c.startContainer,e=c.endContainer;e=0===c.endOffset?e:e.splitText(c.endOffset);
  c=0===c.startOffset?d:d.splitText(c.startOffset);return{prefix:b,end:e.parentNode.insertBefore(ra(a,b+"-end"),e),start:c.parentNode.insertBefore(ra(a,b+"-start"),c)}},ta=function(a,b,c){C(a,a.get(b.prefix+"-end"),c);C(a,a.get(b.prefix+"-start"),c)},db=function(a,b,c){return function(d,e){e=d.data.substring(0,e);d=e.lastIndexOf(c.charAt(c.length-1));e=e.lastIndexOf(c);return-1!==e?e+c.length:-1!==d?d+1:-1}},ua=function(a,b,c,d){var e=b.start;return Ya(a,d.container,d.offset,db(a,c,e),c).bind(function(f){if(f.offset>=
  e.length){var g=a.createRng();g.setStart(f.container,f.offset-e.length);g.setEnd(f.container,f.offset);return l.some(g)}return T(f.container,f.offset-e.length,c).map(function(h){var k=a.createRng();k.setStart(h.container,h.offset);k.setEnd(f.container,f.offset);return k}).filter(function(h){return h.toString()===e}).orThunk(function(){return ua(a,b,c,v(f.container,0))})})},eb=function(a,b,c,d,e,f){void 0===f&&(f=!1);if(0===b.start.length&&!f){var g=a.createRng();g.setStart(c,d);g.setEnd(c,d);return l.some(g)}return S(c,
  d,e).bind(function(h){return ua(a,b,e,h).bind(function(k){return f&&(k.endContainer===h.container&&k.endOffset===h.offset||0===h.offset&&k.endContainer.textContent.length===k.endOffset)?l.none():l.some(k)})})},gb=function(a,b,c){var d=a.dom,e=d.getRoot(),f=c.pattern,g=c.position.container,h=c.position.offset;return T(g,h-c.pattern.end.length,b).bind(function(k){var m=U(e,k.container,k.offset,g,h);if(0===f.start.length)return l.some({matches:[{pattern:f,startRng:m,endRng:m}],position:k});var p=va(a,
  c.remainingPatterns,k.container,k.offset,b),n=p.getOr({matches:[],position:k});k=n.position;return eb(d,f,k.container,k.offset,b,p.isNone()).map(function(u){var fb=U(e,u.startContainer,u.startOffset,u.endContainer,u.endOffset);return{matches:n.matches.concat([{pattern:f,startRng:fb,endRng:m}]),position:v(u.startContainer,u.startOffset)}})})},va=function(a,b,c,d,e){var f=a.dom;return S(c,d,f.getRoot()).bind(function(g){var h=f.createRng();h.setStart(e,0);h.setEnd(c,d);h=h.toString();for(var k=0;k<
  b.length;k++){var m=b[k],p=m.end,n=p;p=h.length-p.length;if(""===n||(h.length<n.length?0:h.substr(p,p+n.length)===n))if(n=b.slice(),n.splice(k,1),m=gb(a,e,{pattern:m,remainingPatterns:n,position:g}),m.isSome())return m}return l.none()})},wa=function(a,b,c){a.selection.setRng(c);"inline-format"===b.type?x(b.format,function(d){a.formatter.apply(d)}):a.execCommand(b.cmd,!1,b.value)},hb=function(a,b,c,d){c=O(a.dom,c);L(a.dom,c,d);wa(a,b,c)},ib=function(a,b,c,d,e){var f=a.dom,g=O(f,d),h=O(f,c);L(f,h,e);
  L(f,g,e);c=O(f,{prefix:c.prefix,start:c.end,end:d.start});wa(a,b,c)},jb=function(a,b){var c=cb("mce_textpattern"),d=Z(b,function(e,f){var g=sa(a,c+("_end"+e.length),f.endRng);return e.concat([y(y({},f),{endMarker:g})])},[]);return Z(d,function(e,f){var g=d.length-e.length-1;g=0===f.pattern.start.length?f.endMarker:sa(a,c+("_start"+g),f.startRng);return e.concat([y(y({},f),{startMarker:g})])},[])},xa=function(a,b,c){var d=a.selection.getRng();return!1===d.collapsed?[]:R(a,d).bind(function(e){return va(a,
  b,d.startContainer,d.startOffset-(c?1:0),e)}).fold(function(){return[]},function(e){return e.matches})},ya=function(a,b){if(0!==b.length){var c=a.dom,d=a.selection.getBookmark();b=jb(c,b);x(b,function(e){var f=c.getParent(e.startMarker.start,c.isBlock),g=function(h){return h===f};0===e.pattern.start.length?hb(a,e.pattern,e.endMarker,g):ib(a,e.pattern,e.startMarker,e.endMarker,g);ta(c,e.endMarker,g);ta(c,e.startMarker,g)});a.selection.moveToBookmark(d)}},za=function(a,b,c){for(var d=0;d<a.length;d++)if(c(a[d],
  b))return!0},H={handleEnter:function(a,b){if(!a.selection.isCollapsed())return!1;var c=xa(a,b.inlinePatterns,!1),d=ab(a,b.blockPatterns);return 0<d.length||0<c.length?(a.undoManager.add(),a.undoManager.extra(function(){a.execCommand("mceInsertNewLine")},function(){a.insertContent("\ufeff");ya(a,c);bb(a,d);var e=a.selection.getRng();e=S(e.startContainer,e.startOffset,a.dom.getRoot());a.execCommand("mceInsertNewLine");e.each(function(f){var g=f.container;"\ufeff"===g.data.charAt(f.offset-1)&&(g.deleteData(f.offset-
  1,1),C(a.dom,g.parentNode,function(h){return h===a.dom.getRoot()}))})}),!0):!1},handleInlineKey:function(a,b){var c=xa(a,b.inlinePatterns,!0);0<c.length&&a.undoManager.transact(function(){ya(a,c)})},checkCharCode:function(a,b){return za(a,b,function(c,d){return c.charCodeAt(0)===d.charCode})},checkKeyCode:function(a,b){return za(a,b,function(c,d){return c===d.keyCode&&!1===ka.modifierPressed(d)})}},kb={setup:function(a,b){var c=",.;:!?".split(""),d=[32];a.on("keydown",function(e){13!==e.keyCode||
  ka.modifierPressed(e)||H.handleEnter(a,b.get())&&e.preventDefault()},!0);a.on("keyup",function(e){H.checkKeyCode(d,e)&&H.handleInlineKey(a,b.get())});a.on("keypress",function(e){H.checkCharCode(c,e)&&Ta.setEditorTimeout(a,function(){H.handleInlineKey(a,b.get())})})}};(function(){Ba.add("textpattern",function(a){var b=V(Sa(a.settings));kb.setup(a,b);return Pa.get(b)})})()})(window);