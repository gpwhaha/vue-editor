(function(){function M(a){return a&&1===a.nodeType&&"false"===a.contentEditable}var N=function(a){var b=a;return{get:function(){return b},set:function(d){b=d},clone:function(){return N(b)}}},fa=tinymce.util.Tools.resolve("tinymce.PluginManager"),y=function(){y=Object.assign||function(a){for(var b,d=1,c=arguments.length;d<c;d++){b=arguments[d];for(var f in b)Object.prototype.hasOwnProperty.call(b,f)&&(a[f]=b[f])}return a};return y.apply(this,arguments)},G=tinymce.util.Tools.resolve("tinymce.util.Tools"),
ia={findAndReplaceDOMText:function(a,b,d,c,f){function g(l,t){t=t||0;if(!l[0])throw Error("findAndReplaceDOMText cannot handle zero-length matches");var B=l.index;if(0<t){t=l[t];if(!t)throw Error("Invalid capture group");B+=l[0].indexOf(t);l[0]=t}return[B,B+l[0].length,[l[0]]]}function q(l){if(3===l.nodeType)return l.data;if(D[l.nodeName]&&!u[l.nodeName])return"";var t="";if(M(l))return"\n";if(u[l.nodeName]||Z[l.nodeName])t+="\n";if(l=l.firstChild){do t+=q(l);while(l=l.nextSibling)}return t}function v(l,
t,B){var n=[],m=0,h=l,z=t.shift(),r=0;a:for(;;){(u[h.nodeName]||Z[h.nodeName]||M(h))&&m++;if(3===h.nodeType){if(!A&&h.length+m>=z[1]){var A=h;var E=z[1]-m}else C&&n.push(h);if(!C&&h.length+m>z[0]){var C=h;var O=z[0]-m}m+=h.length}if(C&&A){if(h=B({startNode:C,startNodeIndex:O,endNode:A,endNodeIndex:E,innerNodes:n,match:z[2],matchIndex:r}),m-=A.length-E,A=C=null,n=[],z=t.shift(),r++,!z)break}else if((!D[h.nodeName]||u[h.nodeName])&&h.firstChild){if(!M(h)){h=h.firstChild;continue}}else if(h.nextSibling){h=
h.nextSibling;continue}for(;;)if(h.nextSibling){h=h.nextSibling;break}else if(h.parentNode!==l)h=h.parentNode;else break a}}function x(l){if("function"!==typeof l){var t=l.nodeType?l:k.createElement(l);var B=function(n,m){var h=t.cloneNode(!1);h.setAttribute("data-mce-index",m);n&&h.appendChild(k.createTextNode(n));return h}}else B=l;return function(n){var m=n.startNode,h=n.endNode,z=n.matchIndex;if(m===h){var r=m.parentNode;if(0<n.startNodeIndex){var A=k.createTextNode(m.data.substring(0,n.startNodeIndex));
r.insertBefore(A,m)}A=B(n.match[0],z);r.insertBefore(A,m);if(n.endNodeIndex<m.length){var E=k.createTextNode(m.data.substring(n.endNodeIndex));r.insertBefore(E,m)}m.parentNode.removeChild(m);return A}A=k.createTextNode(m.data.substring(0,n.startNodeIndex));E=k.createTextNode(h.data.substring(n.endNodeIndex));var C=B(m.data.substring(n.startNodeIndex),z);r=0;for(var O=n.innerNodes.length;r<O;++r){var P=n.innerNodes[r],ha=B(P.data,z);P.parentNode.replaceChild(ha,P)}n=B(h.data.substring(0,n.endNodeIndex),
z);r=m.parentNode;r.insertBefore(A,m);r.insertBefore(C,m);r.removeChild(m);r=h.parentNode;r.insertBefore(n,h);r.insertBefore(E,h);r.removeChild(h);return n}}var p=[],w,e=0;var k=b.ownerDocument;var u=f.getBlockElements();var D=f.getWhiteSpaceElements();var Z=f.getShortEndedElements();if(w=q(b)){if(a.global)for(;f=a.exec(w);)p.push(g(f,c));else f=w.match(a),p.push(g(f,c));p.length&&(e=p.length,v(b,p,x(d)));return e}}},H=function(a){a=a.getAttribute("data-mce-index");return"number"===typeof a?""+a:
a},aa=function(a){var b=a.parentNode;a.firstChild&&b.insertBefore(a.firstChild,a);a.parentNode.removeChild(a)},Q=function(a,b){var d=[];a=G.toArray(a.getBody().getElementsByTagName("span"));if(a.length)for(var c=0;c<a.length;c++){var f=H(a[c]);null!==f&&f.length&&f===b.toString()&&d.push(a[c])}return d},R=function(a,b,d){var c=b.get();b=c.index;var f=a.dom;!1!==d?b+1===c.count?b=0:b++:-1===b-1?b=c.count-1:b--;f.removeClass(Q(a,c.index),"mce-match-marker-selected");d=Q(a,b);return d.length?(f.addClass(Q(a,
b),"mce-match-marker-selected"),a.selection.scrollIntoView(d[0]),b):-1},ba=function(a,b){var d=b.parentNode;a.remove(b);a.isEmpty(d)&&a.remove(d)},ca=function(a,b,d,c,f){var g=d.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s/g,"[^\\S\\r\\n]");g=new RegExp(f?"\\b"+g+"\\b":g,c?"g":"gi");var q=a.dom.create("span",{"data-mce-bogus":1});q.className="mce-match-marker";var v=a.getBody();J(a,b,!1);if(g=ia.findAndReplaceDOMText(g,v,q,!1,a.schema))a=R(a,b,!0),b.set({index:a,count:g,text:d,
matchCase:c,wholeWord:f});return g},K=function(a,b){a=R(a,b,!0);b.set(y(y({},b.get()),{index:a}))},S=function(a,b){a=R(a,b,!1);b.set(y(y({},b.get()),{index:a}))},ja=function(a){a=H(a);return null!==a&&0<a.length},T=function(a,b,d,c,f){var g=b.get(),q=g.index,v,x=q;c=!1!==c;var p=a.getBody();var w=G.grep(G.toArray(p.getElementsByTagName("span")),ja);for(p=0;p<w.length;p++){var e=H(w[p]);e=v=parseInt(e,10);if(f||e===g.index){d.length?(w[p].firstChild.nodeValue=d,aa(w[p])):ba(a.dom,w[p]);for(;w[++p];)if(e=
parseInt(H(w[p]),10),e===v)ba(a.dom,w[p]);else{p--;break}c&&x--}else v>q&&w[p].setAttribute("data-mce-index",String(v-1))}b.set(y(y({},g),{count:f?0:g.count-1,index:x}));c?K(a,b):S(a,b);return!f&&0<b.get().count},J=function(a,b,d){var c,f=b.get();var g=G.toArray(a.getBody().getElementsByTagName("span"));for(c=0;c<g.length;c++){var q=H(g[c]);if(null!==q&&q.length){if(q===f.index.toString()){if(!v)var v=g[c].firstChild;var x=g[c].firstChild}aa(g[c])}}b.set(y(y({},f),{index:-1,count:0,text:""}));if(v&&
x)return b=a.dom.createRng(),b.setStart(v,0),b.setEnd(x,x.data.length),!1!==d&&a.selection.setRng(b),b},ka={get:function(a,b){return{done:function(d){return J(a,b,d)},find:function(d,c,f){return ca(a,b,d,c,f)},next:function(){return K(a,b)},prev:function(){return S(a,b)},replace:function(d,c,f){return T(a,b,d,c,f)}}}},la=function(){},F=function(a){return function(){return a}},I=F(!1),U=F(!0),L=function(){return V},V=function(){var a=function(c){return c.isNone()},b=function(c){return c()},d=function(c){return c};
a={fold:function(c,f){return c()},is:I,isSome:I,isNone:U,getOr:d,getOrThunk:b,getOrDie:function(c){throw Error(c||"error: getOrDie called on none.");},getOrNull:F(null),getOrUndefined:F(void 0),or:d,orThunk:b,map:L,each:la,bind:L,exists:I,forall:U,filter:L,equals:a,equals_:a,toArray:function(){return[]},toString:F("none()")};Object.freeze&&Object.freeze(a);return a}(),W=function(a){var b=F(a),d=function(){return f},c=function(g){return g(a)},f={fold:function(g,q){return q(a)},is:function(g){return a===
g},isSome:U,isNone:I,getOr:b,getOrThunk:b,getOrDie:b,getOrNull:b,getOrUndefined:b,or:d,orThunk:d,map:function(g){return W(g(a))},each:function(g){g(a)},bind:c,exists:c,forall:c,filter:function(g){return g(a)?f:V},toArray:function(){return[a]},toString:function(){return"some("+a+")"},equals:function(g){return g.is(a)},equals_:function(g,q){return g.fold(I,function(v){return q(a,v)})}};return f},X={some:W,none:L,from:function(a){return null===a||void 0===a?V:W(a)}};(function(a){return function(b){if(null===
b)b="null";else{var d=typeof b;b="object"===d&&(Array.prototype.isPrototypeOf(b)||b.constructor&&"Array"===b.constructor.name)?"array":"object"===d&&(String.prototype.isPrototypeOf(b)||b.constructor&&"String"===b.constructor.name)?"string":d}return b===a}})("function")(Array.from);var ma=function(){var a=N(X.none());return{clear:function(){a.set(X.none())},set:function(b){a.set(X.some(b))},isSet:function(){return a.get().isSome()},on:function(b){a.get().each(b)}}},da=tinymce.util.Tools.resolve("tinymce.Env"),
ea={open:function(a,b){function d(e){(1<b.get().count?e.enable:e.disable)("next");(1<b.get().count?e.enable:e.disable)("prev")}function c(e){a.windowManager.alert("Could not find the specified string.",function(){e.focus("findtext")})}var f=ma();a.undoManager.add();var g=G.trim(a.selection.getContent({format:"text"})),q=function(e,k){var u=["replace","replaceall","prev","next"];e=k?e.disable:e.enable;k=0;for(var D=u.length;k<D;k++)e(u[k],k)},v=function(e,k){da.browser.isSafari()&&da.deviceType.isTouch()&&
("find"===k||"replace"===k||"replaceall"===k)&&e.focus(k)},x=function(e){J(a,b,!1);q(e,!0);d(e)},p=function(e){var k=e.getData(),u=b.get();k.findtext.length?(u.text===k.findtext&&u.matchCase===k.matchcase&&u.wholeWord===k.wholewords?K(a,b):(k=ca(a,b,k.findtext,k.matchcase,k.wholewords),0>=k&&c(e),q(e,0===k)),d(e)):x(e)},w=b.get();f.set(a.windowManager.open({title:"Find and Replace",size:"normal",body:{type:"panel",items:[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0,
inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",disabled:!0,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",disabled:!0,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with",inputMode:"search"}]},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"}]},
{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",disabled:!0},{type:"custom",name:"replaceall",text:"Replace All",disabled:!0}],initialData:{findtext:g,replacetext:"",wholewords:w.wholeWord,matchcase:w.matchCase},onChange:function(e,k){"findtext"===k.name&&0<b.get().count&&x(e)},onAction:function(e,k){var u=e.getData();switch(k.name){case "find":p(e);break;case "replace":T(a,b,u.replacetext)?d(e):x(e);break;case "replaceall":T(a,b,u.replacetext,!0,!0);
x(e);break;case "prev":S(a,b);d(e);break;case "next":K(a,b);d(e);break;case "matchcase":case "wholewords":u=e.getData();var D=b.get();b.set(y(y({},D),{matchCase:u.matchcase,wholeWord:u.wholewords}));x(e)}v(e,k.name)},onSubmit:function(e){p(e);v(e,"find")},onClose:function(){a.focus();J(a,b);a.undoManager.add()}},{inline:"toolbar"}))}},na={register:function(a,b){a.addCommand("SearchReplace",function(){ea.open(a,b)})}},Y=function(a,b){return function(){ea.open(a,b)}},oa={register:function(a,b){a.ui.registry.addMenuItem("searchreplace",
{text:"Find and replace...",shortcut:"Meta+F",onAction:Y(a,b),icon:"search"});a.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:Y(a,b),icon:"search"});a.shortcuts.add("Meta+F","",Y(a,b))}};(function(){fa.add("searchreplace",function(a){var b=N({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1});na.register(a,b);oa.register(a,b);return ka.get(a,b)})})()})();